language: r

sudo: true
cache: 
  - packages
  - /travis/grattanReport
  - /tmp/texlive
  - /$HOME/.texlive
warnings_are_errors: false


addons:
  apt:
    packages:
      - libhunspell-dev
      # - hunspell-en-au Wait :-)

r_binary_packages:
  - data.table
  - magrittr
  - fastmatch
  - hutils
  - stringi
  - Rcpp
  - tibble
  - hms
  - R6
  - BH
  - rlang
  - readr  
  - zoo

r_packages:
  - clisymbols
  
r_github_packages:
  - HughParsonage/TeXCheckR
  - HughParsonage/grattanReporter

# Do not omit this step or travis will think you're checking a package
install: echo Installation step

before_script:
    # as somehow no biber package is available for ubuntu 12.04 via apt, let's just download it directly
    # - wget "http://downloads.sourceforge.net/project/biblatex-biber/biblatex-biber/0.9.9/binaries/Linux/biber-linux_x86_64.tar.gz"
    - Rscript -e 'devtools::install_github("hughparsonage/grattanReporter")'
    - Rscript -e 'grattanReporter::setup_travis()'
    - wget "https://sourceforge.net/projects/biblatex-biber/files/biblatex-biber/current/binaries/Linux/biber-linux_x86_64.tar.gz"
    - tar xzf biber-linux_x86_64.tar.gz
    - export PATH=$PATH:$PWD
    - tlmgr update biber

# Not that important but will be quicker
# Disadvantage: queued jobs won't interrupt running builds
git:
  depth: 3

script: 
  - set -e
  - Rscript -e 'Sys.which("pdflatex")'
  - for i in *.tex; do pdflatex -interaction=nonstopmode $i > /dev/null 2>&1; done
  - Rscript -e 'library(grattanReporter);checkGrattanReport(compile = TRUE, pre_release = TRUE, .proceed_after_rerun = 3)'

notifications:
  slack: grattex:7yiVyM6NvMmCE49ccxaUX2QG
  on_success: change
